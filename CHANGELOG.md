# Лог изменений

Все заметные изменения в этом проекте будут отражаться в этом документе.

Формат лога изменений базируется на [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).

## [3.16.25] - 2022-09-01

### Добавлено

* интеграция клиентов с заданной областью (scoped), использующие `HttpClient` из этой области

## [3.15.25] - 2022-06-30

### Изменено

* интеграция сервисов и конфигурирование
* нет ошибки, если при конфигурировании секция конфигурации не найдена

## [3.14.24] - 2022-05-30

### Добавлено

* `PATCH` http-метод

## [3.13.24] - 2022-02-24

### Исправлено

* запросы с `JSON` и `XML` не снабжались заголовком `content-length`

## [3.12.24] - 2022-01-19

### Добавлено

* опция `Api.UrlFormSettings.EscapeSymbols` декодирования в `url-encoded-form`
* опция `Api.UrlFormSettings.IgnoreNullValues` игнорирования не указанных (`null`) параметров в `url-encoded-form`

## [3.11.24] - 2022-01-18

### Добавлено

* возможность через настройки указать игнорирование проверки серверного `SSL` сертификата
* поддержка указания настроек `JSON` сериализации 
* сервис `IApiClientFactory` вместо `IHttpClientFactory` для протаскивания дополнительных настроек в фабрику запросов 

### Изменено

* объектные поля опций инициализированы в конструкторе (не требуют инициализации при присвоении вложенных полей)

## [3.10.22] - 2021-10-27

### Добавлено

* Возможность переопределять имя свойства url-формы запроса 

## [3.9.22] - 2021-10-06

### Изменено

* Добавлен запрет авторедиректа в `HttpClient`

## [3.9.21] - 2021-09-16

### Изменено

* Требование к типу параметра коллекции заголовков: `IEnumerable<KeyValuePair<string, object>>` вместо `IDictionary<string, object>` 

## [3.8.21] - 2021-09-16

### Добавлено

* Поддержка передачи произвольного списка заголовков в качестве параметров метода
* Поддержка типа параметра, передаваемого как `multipart/form-data`

## [3.7.21] - 2021-06-23

### Добавлено

* Свойство `ServerMessage` в исключение `ResponseCodeException`, содержащее оригинальное сообщение от сервера

### Исправлено

* Формирование сообщения исключения `ResponseCodeException` на базе ответа от сервера

## [3.6.21] - 2021-06-03

### Исправлено

* Неправильное формирование адреса запроса в случае, если не указан `URL` для контракта.

### Добавлено

* Нормализация `URL` при регистрации http-клиентов - добавление в конец слэша `/` при необходимости. С целью правильного построения относительных путей в `HttpClient`;
* Вынос формирования результирующего URL запроса в отдельный класс `HttpRequestMessageBuilder` 
* Добавление тестов, покрывающих разные аспекты создания `URL`: от регистрации `HttpClient` до формирования `URL` в запросе. 

## [3.6.20] - 2021-02-17

### Исправлено

* Сериализация даты и времени в `URL` запроса, в заголовке и текстовом содержимом в контексте культуры `InvariantCulture`: `02/17/2021 16:52:2`

## [3.6.19] - 2021-02-02

### Исправлено

* Поведение при неожиданных кодах ответа:
  * при получении результата - исключение `ResponceCodeexception`
  * при получении деталей - нет исключения

## [3.6.18] - 2021-01-29

### Исправлено

* Ошибка при создании дампа ответа для запроса `HEAD`

## [3.6.17] - 2020-12-25

### Исправлено

* Возникала ошибка при обработке ошибки при попытке отправить запрос

## [3.6.16] - 2020-12-24

### Добавлено

*  Поддержка перечислений с переопределёнными именами для сериализации с помощью `Json` конвертером `StringEnumConverter` и атрибутами `EnumMeberAttruibute`.

## [3.6.15] - 2020-12-15

### Изменено

* Теперь не требуется указывать путь на уровне контракта в атрибуте `ApiAttribute`
* Метод `Call` клиента переименован в `Request`
* Разделён readme.md
* Асинхронным методам добавлен `Async` в имя

### Добавлено

* Поддержка запросов и детализаций ответов без содержательного ответа: `ApiRequest` и `CallDetails` - без `generic` параметра

## [3.5.15] - 2020-11-20

### Изменено:

* Добавление API-proxy с временем жизни `Singleton`, а не `Scoped`

## [3.5.14] - 2020-11-11

### Изменено

* При ошибке обработки ответа на запрос в методе `ApiRequest<TRes>.GetResult()` выбрасывается исключение `ResponseProcessingException`
* При ошибке обработки ответа на запрос в методе `ApiRequest<TRes>.GetDetails()` выбрасывается исключение `DetailedResponseProcessingException<TRes>`, содержащее все детали запроса и ответа, кроме самого десериализованного ответа
* Учитывается атрибут `$type` в `json` ответах при десериализации для воссоздания объекта конкретного типа 

### Исправлено

* У запросов с бинарным содержимым не был указан заголовок `ContentType`  

## [3.5.11] - 2020-11-05

### Добавлено

* Поддержка `CallDetails<>` как результатов выполнения методов контрактов API в прозрачном прокси 

## [3.4.11] - 2020-07-31

### Исправлено:

* Не указывался заголовок `Content-Length` запроса для `JSON`

## [3.4.10] - 2020-07-07

### Исправлено:

* Устранён баг привязки конфигурации к зарегистрированному клиенту

## [3.4.7] - 2020-06-03

### Добавлено:

* Контроль наличия секции конфигурации в методе интеграции с указанием имени секции;
* Поддержка типа ответа `application/octet-stream`.

## [3.4.6] - 2020-04-29

### Добавлено

* Игнорирование содержимого ответа, если статус-код ответа не `2хх`;
* Поддержка  шаблонных строк (`$"...{var1}..{var2}..."`) в выражениях вызова методов контрактов API.

## [3.4.5] - 2020-04-29

### Добавлено

* Проверка медиа-типа содержания ответа;
* Игнорирование содержимого ответа `application/problem+json`.

## [3.4.4] - 2020-04-29

### Исправлено

* Исправлена ошибка в случае, если не указан базовый путь контракта;
* Поддержка типов значений в качестве выходного параметра метода `API`: `short`, `ushort`, `long`, `ulong`, `float`, `decimal`. 

## [3.4.3] - 2020-04-28

### Добавлено

* Десериализация ответа типа `IEnumerable<>`

## [3.4.2] - 2020-04-27

### Добавлено 

- Провайдер `HttpClient` для тестов;
- Раздел "Тестирование" в [readme](./readme.md).

## [3.4.1] - 2020-04-26

### Добавлено 

- Поддержка конфигурирования подключений;
- Прокси для прозрачной автоматической реализации контрактов `API`;
- Регистрация контрактов `API` и инъекция их в `DI` контейнер.
- Требование к методам контрактов сервисов - они должны быть асинхронными, т.е. возвращать `Task` или `Task<>`.
- Changelog

### Изменено

- Переход на `.NET Core 3.1` для дальнейшего применения специфичных решений для этой платформы;

### Исправлено

- Возврат значений по умолчанию в случае, если ответ не имеет содержательной части: 
  - `null` для ссылочных типов;
  - `default()` - для типов значений.

